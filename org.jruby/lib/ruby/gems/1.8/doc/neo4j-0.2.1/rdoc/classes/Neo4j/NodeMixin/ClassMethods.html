<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: Neo4j::NodeMixin::ClassMethods</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">Neo4j::NodeMixin::ClassMethods</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/neo4j/mixins/node_rb.html">
                lib/neo4j/mixins/node.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <hr size="10"></hr><p>
<a href="../NodeMixin.html">NodeMixin</a> class methods
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000045">all</a>&nbsp;&nbsp;
      <a href="#M000048">create_value_class</a>&nbsp;&nbsp;
      <a href="#M000047">find</a>&nbsp;&nbsp;
      <a href="#M000044">has_n</a>&nbsp;&nbsp;
      <a href="#M000043">has_one</a>&nbsp;&nbsp;
      <a href="#M000038">index</a>&nbsp;&nbsp;
      <a href="#M000041">index_property</a>&nbsp;&nbsp;
      <a href="#M000042">index_relation</a>&nbsp;&nbsp;
      <a href="#M000031">indexer</a>&nbsp;&nbsp;
      <a href="#M000035">marshal?</a>&nbsp;&nbsp;
      <a href="#M000046">new_relation</a>&nbsp;&nbsp;
      <a href="#M000033">properties_info</a>&nbsp;&nbsp;
      <a href="#M000034">property</a>&nbsp;&nbsp;
      <a href="#M000036">property?</a>&nbsp;&nbsp;
      <a href="#M000032">relations_info</a>&nbsp;&nbsp;
      <a href="#M000039">remove_index</a>&nbsp;&nbsp;
      <a href="#M000030">root_class</a>&nbsp;&nbsp;
      <a href="#M000040">update_index</a>&nbsp;&nbsp;
      <a href="#M000037">value_object</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000045" class="method-detail">
        <a name="M000045"></a>

        <div class="method-heading">
          <a href="#M000045" class="method-signature">
          <span class="method-name">all</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns node instances of this class.
</p>
<p>
:api: public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000045-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000045-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 594</span>
594:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all</span>
595:         <span class="ruby-identifier">ref</span> = <span class="ruby-constant">Neo4j</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">ref_node</span>
596:         <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">relations</span>.<span class="ruby-identifier">outgoing</span>(<span class="ruby-identifier">root_class</span>)
597:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000048" class="method-detail">
        <a name="M000048"></a>

        <div class="method-heading">
          <a href="#M000048" class="method-signature">
          <span class="method-name">create_value_class</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a new value object class (a Struct) represeting this class.
</p>
<p>
The struct will have the Ruby on Rails method: model_name and new_record?
so that it can be used for restful routing.
</p>
<p>
TODO: if the DynamicMixin is used it should return somthing more flexible
since we do not know which <a href="ClassMethods.html#M000034">property</a>
a class has.
</p>
<p>
@api private
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000048-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000048-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 637</span>
637:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_value_class</span>
638:         <span class="ruby-comment cmt"># the name of the class we want to create</span>
639:         <span class="ruby-identifier">name</span> = <span class="ruby-node">&quot;#{self.to_s}ValueObject&quot;</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;::&quot;</span>, <span class="ruby-value str">'_'</span>)
640: 
641:         <span class="ruby-comment cmt"># remove previous class if exists</span>
642:         <span class="ruby-constant">Neo4j</span>.<span class="ruby-identifier">instance_eval</span> <span class="ruby-keyword kw">do</span>
643:           <span class="ruby-identifier">remove_const</span> <span class="ruby-identifier">name</span>
644:         <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Neo4j</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-identifier">name</span>)
645: 
646:         <span class="ruby-comment cmt"># get the properties we want in the new class</span>
647:         <span class="ruby-identifier">props</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">properties_info</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;:#{k}&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-value str">','</span>)
648:         <span class="ruby-constant">Neo4j</span>.<span class="ruby-identifier">module_eval</span> <span class="ruby-node">%Q[class #{name} &lt; Struct.new(#{props}); end]</span>
649: 
650:         <span class="ruby-comment cmt"># get reference to the new class</span>
651:         <span class="ruby-identifier">clazz</span> = <span class="ruby-constant">Neo4j</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">name</span>)
652: 
653:         <span class="ruby-comment cmt"># make it more Ruby on Rails friendly - try adding model_name method</span>
654:         <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:model_name</span>)
655:           <span class="ruby-identifier">model</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">model_name</span>.<span class="ruby-identifier">clone</span>
656:           (<span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">clazz</span>; <span class="ruby-keyword kw">self</span>; <span class="ruby-keyword kw">end</span>).<span class="ruby-identifier">instance_eval</span> <span class="ruby-keyword kw">do</span>
657:             <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">:model_name</span>) {<span class="ruby-identifier">model</span>}
658:           <span class="ruby-keyword kw">end</span>
659:         <span class="ruby-keyword kw">end</span>
660: 
661:         <span class="ruby-comment cmt"># by calling the _update method we change the state of the struct</span>
662:         <span class="ruby-comment cmt"># so that new_record returns false - Ruby on Rails</span>
663:         <span class="ruby-identifier">clazz</span>.<span class="ruby-identifier">instance_eval</span> <span class="ruby-keyword kw">do</span>
664:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">:_update</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span><span class="ruby-operator">|</span>
665:             <span class="ruby-ivar">@_updated</span> = <span class="ruby-keyword kw">true</span>
666:             <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">each_pair</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">value</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">members</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>) }
667:           <span class="ruby-keyword kw">end</span>
668:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">:new_record?</span>) { <span class="ruby-operator">!</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-ivar">@_updated</span> }
669:         <span class="ruby-keyword kw">end</span>
670: 
671:         <span class="ruby-identifier">clazz</span>
672:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000047" class="method-detail">
        <a name="M000047"></a>

        <div class="method-heading">
          <a href="#M000047" class="method-signature">
          <span class="method-name">find</span><span class="method-args">(query=nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Finds <a href="ClassMethods.html#M000045">all</a> nodes of this type (and
ancestors of this type) having the specified <a
href="ClassMethods.html#M000034">property</a> values. See the lucene module
for more information how to do a query.
</p>
<h4>Example</h4>
<pre>
  MyNode.find(:name =&gt; 'foo', :company =&gt; 'bar')
</pre>
<p>
Or using a DSL query (experimental)
</p>
<pre>
  MyNode.find{(name == 'foo') &amp; (company == 'bar')}
</pre>
<h4>Returns</h4>
<p>
<a href="../SearchResult.html">Neo4j::SearchResult</a>
</p>
<p>
:api: public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000047-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000047-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 623</span>
623:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find</span>(<span class="ruby-identifier">query</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
624:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">indexer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">query</span>, <span class="ruby-identifier">block</span>)
625:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000044" class="method-detail">
        <a name="M000044"></a>

        <div class="method-heading">
          <a href="#M000044" class="method-signature">
          <span class="method-name">has_n</span><span class="method-args">(rel_type)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Specifies a relationship between two node classes.
</p>
<h4>Example</h4>
<pre>
  class Order
     has_n(:order_lines).to(Product).relation(OrderLine)
  end
</pre>
<p>
:api: public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000044-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000044-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 583</span>
583:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_n</span>(<span class="ruby-identifier">rel_type</span>)
584:         <span class="ruby-identifier">module_eval</span>(<span class="ruby-node">%Q{def #{rel_type}(&amp;block)
585:                         Relations::HasN.new(self,'#{rel_type.to_s}', &amp;block)
586:                     end}</span>,  <span class="ruby-keyword kw">__FILE__</span>, <span class="ruby-keyword kw">__LINE__</span>)
587:         <span class="ruby-identifier">relations_info</span>[<span class="ruby-identifier">rel_type</span>] = <span class="ruby-constant">Relations</span><span class="ruby-operator">::</span><span class="ruby-constant">RelationInfo</span>.<span class="ruby-identifier">new</span>
588:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000043" class="method-detail">
        <a name="M000043"></a>

        <div class="method-heading">
          <a href="#M000043" class="method-signature">
          <span class="method-name">has_one</span><span class="method-args">(rel_type)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Specifies a relationship between two node classes.
</p>
<h4>Example</h4>
<pre>
  class Order
     has_one(:customer).of_class(Customer)
  end
</pre>
<p>
:api: public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000043-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000043-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 559</span>
559:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_one</span>(<span class="ruby-identifier">rel_type</span>)
560: 
561:         <span class="ruby-identifier">module_eval</span>(<span class="ruby-node">%Q{def #{rel_type}=(value)
562:                         r = Relations::HasN.new(self,'#{rel_type.to_s}')
563:                         r &lt;&lt; value
564:                     end}</span>,  <span class="ruby-keyword kw">__FILE__</span>, <span class="ruby-keyword kw">__LINE__</span>)
565:         
566:         <span class="ruby-identifier">module_eval</span>(<span class="ruby-node">%Q{def #{rel_type}
567:                         r = Relations::HasN.new(self,'#{rel_type.to_s}')
568:                         r.to_a[0]
569:                     end}</span>,  <span class="ruby-keyword kw">__FILE__</span>, <span class="ruby-keyword kw">__LINE__</span>)
570:         <span class="ruby-identifier">relations_info</span>[<span class="ruby-identifier">rel_type</span>] = <span class="ruby-constant">Relations</span><span class="ruby-operator">::</span><span class="ruby-constant">RelationInfo</span>.<span class="ruby-identifier">new</span>
571:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000038" class="method-detail">
        <a name="M000038"></a>

        <div class="method-heading">
          <a href="#M000038" class="method-signature">
          <span class="method-name">index</span><span class="method-args">(*rel_type_props)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Index a <a href="ClassMethods.html#M000034">property</a> or a relationship.
If the rel_prop arg contains a &#8217;.&#8217; then it will <a
href="ClassMethods.html#M000038">index</a> the relationship. For example
&quot;friends.name&quot; will <a href="ClassMethods.html#M000038">index</a>
each node with <a href="ClassMethods.html#M000034">property</a> name in the
relationship friends. For example &quot;name&quot; will <a
href="ClassMethods.html#M000038">index</a> the name <a
href="ClassMethods.html#M000034">property</a> of this <a
href="../NodeMixin.html">NodeMixin</a> class.
</p>
<h4>Example</h4>
<pre>
  class Person
    include Neo4j::NodeMixin
    property :name
    index :name
  end
</pre>
<p>
:api: public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000038-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000038-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 484</span>
484:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">rel_type_props</span>)
485:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rel_type_props</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">rel_type_props</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>)
486:           <span class="ruby-identifier">rel_type_props</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
487:             <span class="ruby-identifier">idx</span> = <span class="ruby-identifier">rel_type_props</span>[<span class="ruby-value">0</span>]
488:             <span class="ruby-identifier">indexer</span>.<span class="ruby-identifier">field_infos</span>[<span class="ruby-identifier">idx</span>.<span class="ruby-identifier">to_sym</span>][<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
489:           <span class="ruby-keyword kw">end</span>
490:           <span class="ruby-identifier">rel_type_props</span> = <span class="ruby-identifier">rel_type_props</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">0</span>]
491:         <span class="ruby-keyword kw">end</span>
492:         <span class="ruby-identifier">rel_type_props</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rel_type_prop</span><span class="ruby-operator">|</span>
493:           <span class="ruby-identifier">rel_name</span>, <span class="ruby-identifier">prop</span> = <span class="ruby-identifier">rel_type_prop</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'.'</span>)
494:           <span class="ruby-identifier">index_property</span>(<span class="ruby-identifier">rel_name</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prop</span>.<span class="ruby-identifier">nil?</span>
495:           <span class="ruby-identifier">index_relation</span>(<span class="ruby-identifier">rel_name</span>, <span class="ruby-identifier">prop</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">prop</span>.<span class="ruby-identifier">nil?</span>
496:         <span class="ruby-keyword kw">end</span>
497:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000041" class="method-detail">
        <a name="M000041"></a>

        <div class="method-heading">
          <a href="#M000041" class="method-signature">
          <span class="method-name">index_property</span><span class="method-args">(prop)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
:api: private
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000041-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000041-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 529</span>
529:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index_property</span>(<span class="ruby-identifier">prop</span>)
530:         <span class="ruby-identifier">indexer</span>.<span class="ruby-identifier">add_index_on_property</span>(<span class="ruby-identifier">prop</span>)
531:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000042" class="method-detail">
        <a name="M000042"></a>

        <div class="method-heading">
          <a href="#M000042" class="method-signature">
          <span class="method-name">index_relation</span><span class="method-args">(rel_name, prop)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
:api: private
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000042-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000042-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 535</span>
535:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">index_relation</span>(<span class="ruby-identifier">rel_name</span>, <span class="ruby-identifier">prop</span>)
536:         <span class="ruby-comment cmt"># find the trigger and updater classes and the rel_type of the given rel_name</span>
537:         <span class="ruby-identifier">trigger_clazz</span> = <span class="ruby-identifier">relations_info</span>[<span class="ruby-identifier">rel_name</span>.<span class="ruby-identifier">to_sym</span>][<span class="ruby-identifier">:class</span>]
538:         <span class="ruby-identifier">trigger_clazz</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">self</span> <span class="ruby-comment cmt"># if not defined in a has_n</span>
539: 
540:         <span class="ruby-identifier">updater_clazz</span> = <span class="ruby-keyword kw">self</span>
541: 
542:         <span class="ruby-identifier">rel_type</span> = <span class="ruby-identifier">relations_info</span>[<span class="ruby-identifier">rel_name</span>.<span class="ruby-identifier">to_sym</span>][<span class="ruby-identifier">:type</span>]  <span class="ruby-comment cmt"># this or the other node we index ?</span>
543:         <span class="ruby-identifier">rel_type</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">rel_name</span> <span class="ruby-comment cmt"># if not defined (in a has_n) use the same name as the rel_name</span>
544: 
545:         <span class="ruby-comment cmt"># add index on the trigger class and connect it to the updater_clazz</span>
546:         <span class="ruby-comment cmt"># (a trigger may cause an update of the index using the Indexer specified on the updater class)</span>
547:         <span class="ruby-identifier">trigger_clazz</span>.<span class="ruby-identifier">indexer</span>.<span class="ruby-identifier">add_index_in_relation_on_property</span>(<span class="ruby-identifier">updater_clazz</span>, <span class="ruby-identifier">rel_name</span>, <span class="ruby-identifier">rel_type</span>, <span class="ruby-identifier">prop</span>)
548:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000031" class="method-detail">
        <a name="M000031"></a>

        <div class="method-heading">
          <a href="#M000031" class="method-signature">
          <span class="method-name">indexer</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000031-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000031-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 334</span>
334:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">indexer</span>
335:         <span class="ruby-constant">Indexer</span>.<span class="ruby-identifier">instance</span>(<span class="ruby-identifier">root_class</span>)
336:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000035" class="method-detail">
        <a name="M000035"></a>

        <div class="method-heading">
          <a href="#M000035" class="method-signature">
          <span class="method-name">marshal?</span><span class="method-args">(prop_name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the given <a href="ClassMethods.html#M000034">property</a>
name should be marshalled. All properties that has a type will be
marshalled.
</p>
<h5>Example</h5>
<pre>
  class Foo
    include Neo4j::NodeMixin
    property :name
    property :since, :type =&gt; Date
  end
  Foo.marshal?(:since) =&gt; true
  Foo.marshal?(:name) =&gt; false
</pre>
<h4>Returns</h4>
<p>
true if the <a href="ClassMethods.html#M000034">property</a> will be
marshalled, false otherwise
</p>
<p>
:api: public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000035-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000035-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 431</span>
431:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">marshal?</span>(<span class="ruby-identifier">prop_name</span>)
432:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">properties_info</span>[<span class="ruby-identifier">prop_name</span>.<span class="ruby-identifier">to_sym</span>].<span class="ruby-identifier">nil?</span>
433:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">properties_info</span>[<span class="ruby-identifier">prop_name</span>.<span class="ruby-identifier">to_sym</span>][<span class="ruby-identifier">:type</span>].<span class="ruby-identifier">nil?</span>
434:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
435:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000046" class="method-detail">
        <a name="M000046"></a>

        <div class="method-heading">
          <a href="#M000046" class="method-signature">
          <span class="method-name">new_relation</span><span class="method-args">(rel_name, internal_relation)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a new outgoing relation.
</p>
<p>
:api: private
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000046-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000046-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 603</span>
603:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_relation</span>(<span class="ruby-identifier">rel_name</span>, <span class="ruby-identifier">internal_relation</span>)
604:         <span class="ruby-identifier">relations_info</span>[<span class="ruby-identifier">rel_name</span>.<span class="ruby-identifier">to_sym</span>][<span class="ruby-identifier">:relation</span>].<span class="ruby-identifier">new</span>(<span class="ruby-identifier">internal_relation</span>) <span class="ruby-comment cmt"># internal_relation is a java neo object</span>
605:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000033" class="method-detail">
        <a name="M000033"></a>

        <div class="method-heading">
          <a href="#M000033" class="method-signature">
          <span class="method-name">properties_info</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
:api: private
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000033-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000033-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 347</span>
347:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">properties_info</span>
348:         <span class="ruby-keyword kw">self</span><span class="ruby-operator">::</span><span class="ruby-constant">PROPERTIES_INFO</span>
349:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000034" class="method-detail">
        <a name="M000034"></a>

        <div class="method-heading">
          <a href="#M000034" class="method-signature">
          <span class="method-name">property</span><span class="method-args">(*props)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Generates accessor method and sets configuration for <a
href="../../Neo4j.html">Neo4j</a> node properties. The generated accessor
is a simple wrapper around the set_property and get_property methods.
</p>
<p>
If a <a href="ClassMethods.html#M000034">property</a> is set to nil the <a
href="ClassMethods.html#M000034">property</a> will be removed.
</p>
<h4>Configuration</h4>
<p>
By setting the :type configuration parameter to &#8216;Object&#8217; makes
it possible to marshal any ruby object.
</p>
<p>
If no type is provided the only the native <a
href="../../Neo4j.html">Neo4j</a> <a
href="ClassMethods.html#M000034">property</a> types are allowed:
</p>
<ul>
<li>TrueClass, FalseClass

</li>
<li>String

</li>
<li>Fixnum

</li>
<li>Float

</li>
<li>Boolean

</li>
</ul>
<h4>Parameters</h4>
<table>
<tr><td valign="top">props&lt;Array,Hash&gt;:</td><td>a variable length arguments or a hash, see example below

</td></tr>
</table>
<h4>Example</h4>
<pre>
  class Baaz; end

  class Foo
    include Neo4j::NodeMixin
    property name, city # can set several properties in one go
    property bar, :type =&gt; Object # allow serialization of any ruby object
  end

  f = Foo.new
  f.bar = Baaz.new
</pre>
<p>
:api: public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000034-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000034-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 389</span>
389:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">property</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">props</span>)
390:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">props</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">props</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>)
391:           <span class="ruby-identifier">props</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>,<span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
392:             <span class="ruby-identifier">pname</span> = <span class="ruby-identifier">props</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_sym</span>
393:             <span class="ruby-identifier">properties_info</span>[<span class="ruby-identifier">pname</span>] <span class="ruby-operator">||=</span> {}
394:             <span class="ruby-identifier">properties_info</span>[<span class="ruby-identifier">pname</span>][<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>
395:           <span class="ruby-keyword kw">end</span>
396:           <span class="ruby-identifier">props</span> = <span class="ruby-identifier">props</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">0</span>]
397:         <span class="ruby-keyword kw">end</span>
398: 
399:         <span class="ruby-identifier">props</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">prop</span><span class="ruby-operator">|</span>
400:           <span class="ruby-identifier">pname</span> = <span class="ruby-identifier">prop</span>.<span class="ruby-identifier">to_sym</span>
401:           <span class="ruby-identifier">properties_info</span>[<span class="ruby-identifier">pname</span>] <span class="ruby-operator">||=</span> {}
402:           <span class="ruby-identifier">properties_info</span>[<span class="ruby-identifier">pname</span>][<span class="ruby-identifier">:defined</span>] = <span class="ruby-keyword kw">true</span>
403:         
404:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">pname</span>) <span class="ruby-keyword kw">do</span>
405:             <span class="ruby-identifier">get_property</span>(<span class="ruby-identifier">pname</span>.<span class="ruby-identifier">to_s</span>)
406:           <span class="ruby-keyword kw">end</span>
407: 
408:           <span class="ruby-identifier">name</span> = (<span class="ruby-identifier">pname</span>.<span class="ruby-identifier">to_s</span>() <span class="ruby-operator">+</span><span class="ruby-value str">&quot;=&quot;</span>).<span class="ruby-identifier">to_sym</span>
409:           <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
410:             <span class="ruby-identifier">set_property</span>(<span class="ruby-identifier">pname</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">value</span>)
411:           <span class="ruby-keyword kw">end</span>
412:         <span class="ruby-keyword kw">end</span>
413:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000036" class="method-detail">
        <a name="M000036"></a>

        <div class="method-heading">
          <a href="#M000036" class="method-signature">
          <span class="method-name">property?</span><span class="method-args">(prop_name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the given <a href="ClassMethods.html#M000034">property</a>
name has been defined with the class method <a
href="ClassMethods.html#M000034">property</a> or properties.
</p>
<p>
Notice that the node may have properties that has not been declared. It is
always possible to set an undeclared <a
href="ClassMethods.html#M000034">property</a> on a node.
</p>
<h4>Returns</h4>
<p>
true or false
</p>
<p>
:api: public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000036-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000036-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 448</span>
448:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">property?</span>(<span class="ruby-identifier">prop_name</span>)
449:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">properties_info</span>[<span class="ruby-identifier">prop_name</span>.<span class="ruby-identifier">to_sym</span>].<span class="ruby-identifier">nil?</span>
450:         <span class="ruby-identifier">properties_info</span>[<span class="ruby-identifier">prop_name</span>.<span class="ruby-identifier">to_sym</span>][<span class="ruby-identifier">:defined</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
451:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000032" class="method-detail">
        <a name="M000032"></a>

        <div class="method-heading">
          <a href="#M000032" class="method-signature">
          <span class="method-name">relations_info</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Contains information of <a href="ClassMethods.html#M000045">all</a>
relationships, name, type, and multiplicity
</p>
<p>
:api: private
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000032-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000032-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 342</span>
342:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">relations_info</span>
343:         <span class="ruby-keyword kw">self</span><span class="ruby-operator">::</span><span class="ruby-constant">RELATIONS_INFO</span>
344:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000039" class="method-detail">
        <a name="M000039"></a>

        <div class="method-heading">
          <a href="#M000039" class="method-signature">
          <span class="method-name">remove_index</span><span class="method-args">(*keys)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Remote one or more specified indexes. This indexes will not be updated
anymore, old indexes will still exist until the <a
href="ClassMethods.html#M000040">update_index</a> method is called.
</p>
<p>
:api: public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000039-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000039-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 505</span>
505:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_index</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">keys</span>)
506:         <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
507:           <span class="ruby-identifier">rel_name</span>, <span class="ruby-identifier">prop</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'.'</span>)
508:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prop</span>.<span class="ruby-identifier">nil?</span>
509:             <span class="ruby-identifier">indexer</span>.<span class="ruby-identifier">remove_index_on_property</span>(<span class="ruby-identifier">rel_name</span>)
510:           <span class="ruby-keyword kw">else</span>
511:             <span class="ruby-identifier">clazz</span>, <span class="ruby-identifier">rel_type</span> = <span class="ruby-identifier">rel_class_and_type_for</span>(<span class="ruby-identifier">rel_name</span>)
512:             <span class="ruby-identifier">clazz</span>.<span class="ruby-identifier">indexer</span>.<span class="ruby-identifier">remove_index_in_relation_on_property</span>(<span class="ruby-identifier">rel_type</span>, <span class="ruby-identifier">prop</span>)
513:           <span class="ruby-keyword kw">end</span>
514:         <span class="ruby-keyword kw">end</span>
515:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000030" class="method-detail">
        <a name="M000030"></a>

        <div class="method-heading">
          <a href="#M000030" class="method-signature">
          <span class="method-name">root_class</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
:api: private
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000030-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000030-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 330</span>
330:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">root_class</span>
331:         <span class="ruby-keyword kw">self</span><span class="ruby-operator">::</span><span class="ruby-constant">ROOT_CLASS</span>
332:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000040" class="method-detail">
        <a name="M000040"></a>

        <div class="method-heading">
          <a href="#M000040" class="method-signature">
          <span class="method-name">update_index</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Traverse <a href="ClassMethods.html#M000045">all</a> nodes and update the
lucene <a href="ClassMethods.html#M000038">index</a>. Can be used for
example if it is neccessarly to change the <a
href="ClassMethods.html#M000038">index</a> on a class
</p>
<p>
:api: public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000040-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000040-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 522</span>
522:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_index</span>
523:         <span class="ruby-identifier">all</span>.<span class="ruby-identifier">nodes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
524:           <span class="ruby-identifier">n</span>.<span class="ruby-identifier">update_index</span>
525:         <span class="ruby-keyword kw">end</span>
526:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000037" class="method-detail">
        <a name="M000037"></a>

        <div class="method-heading">
          <a href="#M000037" class="method-signature">
          <span class="method-name">value_object</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a struct class containig <a
href="ClassMethods.html#M000045">all</a> properties of this class.
</p>
<h4>Example</h4>
<p>
h = Person.value_object.new h.name # =&gt; nil h.name=&#8217;kalle&#8217;
h[:name] # =&gt; &#8216;kalle&#8216;
</p>
<h4>Returns</h4>
<p>
Struct
</p>
<p>
:api: public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000037-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000037-source">
<pre>
     <span class="ruby-comment cmt"># File lib/neo4j/mixins/node.rb, line 467</span>
467:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">value_object</span>
468:         <span class="ruby-ivar">@value_class</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">create_value_class</span>
469:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>